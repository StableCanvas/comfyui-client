# cw-reader

ComfyUI Workflow Reader

```
npm install @stable-canvas/cw-reader
```

references:

- [comfyui-client](https://github.com/StableCanvas/comfyui-client)

# Usage

- NodeJS

```ts
import { ImageReader } from "@stable-canvas/cw-reader";
const file1 = await fs.promises.readFile("./tests/img2img_workflow.png");
const reader = new ImageReader(file1.buffer);
const workflow = await reader.getWorkflowJson();
await fs.promises.writeFile(
  "./img2img_workflow.json",
  JSON.stringify(workflow, null, 2),
);
```

- ESM

```html
<input type="file" accept="image/*" />
<pre><code id="output">// Output will appear here</code></pre>

<script type="module">
  import { ImageReader } from "https://esm.run/@stable-canvas/cw-reader";

  const fileInput = dropZone.querySelector("input");
  const output = document.getElementById("output");

  async function handleFile(file) {
    try {
      const arrayBuffer = await file.arrayBuffer();
      const reader = new ImageReader(arrayBuffer);
      const workflow = await reader.getWorkflowJson();
      output.textContent = JSON.stringify(workflow, null, 2);
    } catch (err) {
      output.textContent = `Error: ${err.message}`;
    }
  }
</script>
```

# What is `./data/\*.json`

## `comfyui.node.types.json`

This file comes from the ComfyUI runtime and is used during code generation to annotate output types.

(The “types” here refer to internal types used by ComfyUI; in the generated code, they are only written as comments without any type checking.)

It is generated by a script. Since the script is extremely simple, it doesn’t make sense to open source it for now. Also, whether this file is correct or not does not affect the use of the library, so it won’t be updated in real-time.

## `comfyui.node.widgets.json`

This file comes from the ComfyUI WebUI runtime environment. It is required when parsing non-API format workflows.

This file affects the final execution result, because workflow definition files are missing some content needed for API requests. These values are estimated using this file. If the file content is incorrect, workflow parsing will fail.

Therefore, it is not recommended to use workflow documents for code generation.
