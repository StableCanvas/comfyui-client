<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@stable-canvas/comfyui-client - v1.5.6</title><meta name="description" content="Documentation for @stable-canvas/comfyui-client"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@stable-canvas/comfyui-client - v1.5.6</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@stable-canvas/comfyui-client - v1.5.6</h2></div><div class="tsd-panel tsd-typography"><a id="md:stable-canvascomfyui-client" class="tsd-anchor"></a><h1><a href="#md:stable-canvascomfyui-client">@stable-canvas/comfyui-client</a></h1><p><a href="https://www.npmjs.com/package/@stable-canvas/comfyui-client"><img src="https://img.shields.io/npm/v/@stable-canvas/comfyui-client" alt="npm"></a>
<a href="https://www.npmjs.com/package/@stable-canvas/comfyui-client"><img src="https://img.shields.io/npm/dw/@stable-canvas/comfyui-client" alt="npm"></a>
<a href="https://github.com/StableCanvas/comfyui-client"><img src="https://img.shields.io/github/stars/StableCanvas/comfyui-client" alt="GitHub Repo stars"></a></p>
<p>Javascript api Client for <a href="https://github.com/comfyanonymous/ComfyUI">ComfyUI</a> that supports both NodeJS and Browser environments.</p>
<p>This client provides comprehensive support for all available RESTful and WebSocket APIs, with built-in TypeScript typings for enhanced development experience. Additionally, it introduces a programmable workflow interface, making it easy to create and manage workflows in a human-readable format.</p>
<p>documentations:</p>
<ul>
<li><a href="https://stablecanvas.github.io/comfyui-client/classes/Client.html">Rest API</a></li>
<li><a href="https://stablecanvas.github.io/comfyui-client/classes/WsClient.html">WebSocket API</a></li>
<li><a href="https://stablecanvas.github.io/comfyui-client/classes/Workflow.html">Workflow API</a></li>
</ul>
<p>examples:</p>
<ul>
<li>nodejs<ul>
<li><a href="examples/nodejs/src/main.ts">client api</a></li>
<li><a href="examples/nodejs/src/main-wf.ts">workflow factory</a></li>
<li><a href="examples/nodejs/src/main-poll.ts">polling</a></li>
<li><a href="examples/nodejs/src/main-pipe-i2i.ts">pipe: image to image</a></li>
<li><a href="examples/nodejs/src/main-pipe-t2i.ts">pipe: text to image</a></li>
</ul>
</li>
<li><a href="examples/web/index.html">Web</a></li>
</ul>
<a id="md:features" class="tsd-anchor"></a><h2><a href="#md:features">Features</a></h2><ul>
<li><strong>Environment Compatibility</strong>: Seamlessly functions in both NodeJS and Browser environments.</li>
<li><strong>Comprehensive API Support</strong>: Provides full support for all available RESTful and WebSocket APIs.</li>
<li><strong>TypeScript Typings</strong>: Comes with built-in TypeScript support for type safety and better development experience.</li>
<li><strong>Programmable Workflows</strong>: Introduces a human-readable and highly customizable workflow interface inspired by <a href="https://github.com/comfyanonymous/ComfyUI/issues/612">this issue</a> and <a href="https://github.com/Chaoses-Ib/ComfyScript">this library</a>.</li>
<li><strong>Ease of Use</strong>: Both implementation and usage are designed to be intuitive and user-friendly.</li>
<li><strong>Zero Dependencies</strong>: This library is designed to minimize the introduction of external dependencies and is currently dependency-free.</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2><a href="#md:installation">Installation</a></h2><p>Use npm or yarn to install the <code>@stable-canvas/comfyui-client</code> package.</p>
<pre><code class="language-bash"><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@stable-canvas/comfyui-client</span>
</code><button>Copy</button></pre>
<a id="md:cdn" class="tsd-anchor"></a><h3><a href="#md:cdn">CDN</a></h3><table>
<thead>
<tr>
<th>Format</th>
<th>Link</th>
</tr>
</thead>
<tbody><tr>
<td>ESM</td>
<td><a href="https://cdn.jsdelivr.net/npm/@stable-canvas/comfyui-client@latest/dist/main.module.mjs">jsDelivr</a></td>
</tr>
<tr>
<td></td>
<td><a href="https://unpkg.com/@stable-canvas/comfyui-client@latest/dist/main.module.mjs">unpkg</a></td>
</tr>
<tr>
<td>UMD</td>
<td><a href="https://cdn.jsdelivr.net/npm/@stable-canvas/comfyui-client@latest">jsDelivr</a></td>
</tr>
<tr>
<td></td>
<td><a href="https://unpkg.com/@stable-canvas/comfyui-client@latest">unpkg</a></td>
</tr>
</tbody></table>
<a id="md:comfyui-dependencies-optional" class="tsd-anchor"></a><h3><a href="#md:comfyui-dependencies-optional">ComfyUI Dependencies (optional)</a></h3><p>To fully utilize the features of this library, your ComfyUI installation needs to support custom nodes for external extensions.</p>
<blockquote>
<p>These nodes are used to accept base64 encoded input and forward WebSocket requests.</p>
<p><strong>Note</strong>: If you don&#39;t need functionalities like <code>returning images via WebSocket</code>, <code>image to image</code>, or <code>inpainting</code>, you don&#39;t need to install these nodes.</p>
</blockquote>
<ul>
<li><a href="https://github.com/Acly/comfyui-tooling-nodes">comfyui-tooling-nodes</a>: A crucial extension that provides the ability to handle base64 API transmissions; <code>image to image</code> and <code>inpainting</code> functionalities depend on it.</li>
<li><a href="https://github.com/jags111/efficiency-nodes-comfyui">efficiency-nodes-comfyui</a>: This library provides a convenient LoRA manager, which is required in the <code>src/pipeline/efficient</code> module.</li>
</ul>
<a id="md:browser-polyfill-optional" class="tsd-anchor"></a><h3><a href="#md:browser-polyfill-optional">Browser Polyfill (optional)</a></h3><p>If you plan to use the <code>pipeline</code> feature in a browser environment, you&#39;ll need to install the following dependencies and convert <code>File</code>/<code>Image</code> types to <code>Buffer</code> types.</p>
<ul>
<li><a href="https://github.com/feross/buffer">Buffer</a>: buffer polyfill for browser</li>
<li><a href="https://github.com/feross/blob-to-buffer">blob-to-buffer</a>: convert blob to buffer</li>
</ul>
<a id="md:client-usage" class="tsd-anchor"></a><h2><a href="#md:client-usage">Client Usage</a></h2><p>First, import the <code>Client</code> class from the package.</p>
<pre><code class="language-javascript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Client</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfyui-client&quot;</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>Client instance, in Browser</p>
<pre><code class="language-js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Client</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">api_host:</span><span class="hl-1"> </span><span class="hl-2">&quot;127.0.0.1:8188&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-7">// connect ws client</span><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<p>Client instance, in NodeJs</p>
<pre><code class="language-js"><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">WebSocket</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;ws&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">fetch</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;node-fetch&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Client</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-7">//...</span><br/><span class="hl-1">  </span><span class="hl-4">WebSocket</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">fetch</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-7">// connect ws client</span><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:routes" class="tsd-anchor"></a><h3><a href="#md:routes">Routes</a></h3><p>This library is built on top of ComfyUI&#39;s API routes, so it naturally supports all of its available endpoints. For detailed information about the built-in ComfyUI API endpoints, you can refer to <a href="https://docs.comfy.org/development/comfyui-server/comms_routes">this page</a>.</p>
<table>
<thead>
<tr>
<th><strong>Function Name</strong></th>
<th><strong>Path</strong></th>
<th><strong>Purpose</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>client.getExtensions</code></td>
<td><code>GET /extensions</code></td>
<td>Retrieve a list of extension URLs.</td>
</tr>
<tr>
<td><code>client.getEmbeddings</code></td>
<td><code>GET /embeddings</code></td>
<td>Retrieve a list of embedding names.</td>
</tr>
<tr>
<td><code>client.getNodeDefs</code></td>
<td><code>GET /object_info</code></td>
<td>Load node object definitions for the graph.</td>
</tr>
<tr>
<td><code>client.queuePrompt</code></td>
<td><code>POST /prompt</code></td>
<td>Queue a prompt with options for prompt data and workflow.</td>
</tr>
<tr>
<td><code>client.getQueue</code></td>
<td><code>GET /queue</code></td>
<td>Retrieve the current state of the queue (running and pending items).</td>
</tr>
<tr>
<td><code>client.getHistory</code></td>
<td><code>GET /history</code></td>
<td>Retrieve the execution history of prompts including node outputs.</td>
</tr>
<tr>
<td><code>client.clearItems</code></td>
<td><code>POST /queue</code> / <code>POST /history</code></td>
<td>Clear the specified list (queue or history).</td>
</tr>
<tr>
<td><code>client.deleteItem</code></td>
<td><code>POST /queue</code> / <code>POST /history</code></td>
<td>Delete a specific item from the queue or history.</td>
</tr>
<tr>
<td><code>client.interrupt</code></td>
<td><code>POST /interrupt</code></td>
<td>Interrupt the execution of the running prompt.</td>
</tr>
<tr>
<td><code>client.free</code></td>
<td><code>POST /free</code></td>
<td>Free memory by unloading models and clearing resources.</td>
</tr>
<tr>
<td><code>client.getSystemStats</code></td>
<td><code>GET /system_stats</code></td>
<td>Retrieve system and device statistics, such as Python version and VRAM.</td>
</tr>
</tbody></table>
<p>If you need documentation on the <code>Client</code> class, you can check out the auto-generated <a href="https://stablecanvas.github.io/comfyui-client/classes/Client.html">documentation webpage</a>.</p>
<a id="md:release-model--free-memory" class="tsd-anchor"></a><h4><a href="#md:release-model--free-memory">Release Model / Free Memory</a></h4><p>There are many times when you might need to release memory. You can directly use the encapsulated functions above the <code>Client</code> class instance, like this:</p>
<pre><code class="language-ts"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">free</span><span class="hl-1">({ </span><span class="hl-4">unload_models:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">, </span><span class="hl-4">free_memory:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:custom-routes" class="tsd-anchor"></a><h4><a href="#md:custom-routes">Custom Routes</a></h4><p>If you have installed a plugin with custom routes, you may want to call specific routes. You can make requests in the following way (assuming the route is <code>/get_something</code>):</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">fetchApi</span><span class="hl-1">(</span><span class="hl-2">&quot;/get_something&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:advanced-functions" class="tsd-anchor"></a><h3><a href="#md:advanced-functions">Advanced functions</a></h3><p>In addition to the standard API interfaces provided by comfyui, this library also wraps them to provide advanced calls</p>
<a id="md:enqueue" class="tsd-anchor"></a><h4><a href="#md:enqueue">enqueue</a></h4><pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-7">/* workflow prompt */</span><span class="hl-1"> },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-0">progress</span><span class="hl-4">:</span><span class="hl-1"> ({</span><span class="hl-4">max</span><span class="hl-1">,</span><span class="hl-4">value</span><span class="hl-1">}) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`progress: </span><span class="hl-5">${</span><span class="hl-4">value</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-4">max</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>It&#39;s very simple; it includes the entire prompt interface life cycle and waits for and collectively returns the result at the end of the request</p>
<blockquote>
<p>In some cases you might not want to use ws, then you can use <code>enqueue_polling</code>, this function will perform similar behavior to <code>enqueue</code>, but uses rest http to poll the task status</p>
</blockquote>
<a id="md:get-xxx" class="tsd-anchor"></a><h4><a href="#md:get-xxx">Get XXX</a></h4><p>Sometimes you may need to check some configurations of ComfyUI, such as whether a deployment service contains the needed model or lora, then these interfaces will be useful</p>
<p><code>getSamplers</code> <code>getSchedulers</code> <code>getSDModels</code> <code>getCNetModels</code> <code>getUpscaleModels</code> <code>getHyperNetworks</code> <code>getLoRAs</code> <code>getVAEs</code></p>
<a id="md:pipeline-usage" class="tsd-anchor"></a><h2><a href="#md:pipeline-usage">Pipeline Usage</a></h2><p>The pipeline is a simple DSL implementation in this library that allows for easy creation of simple workflows and immediate results.</p>
<a id="md:text-to-image" class="tsd-anchor"></a><h3><a href="#md:text-to-image">Text to Image</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">BasePipe</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfyui-client&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">BasePipe</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">with</span><span class="hl-1">(</span><span class="hl-7">/* client instance */</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">model</span><span class="hl-1">(</span><span class="hl-2">&quot;sdxl.safetensors&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">prompt</span><span class="hl-1">(</span><span class="hl-2">&quot;A beautiful sunset over the mountains&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">negative</span><span class="hl-1">(</span><span class="hl-2">&quot;Low quality, blurry&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">size</span><span class="hl-1">(</span><span class="hl-8">1024</span><span class="hl-1">, </span><span class="hl-8">768</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">steps</span><span class="hl-1">(</span><span class="hl-8">35</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">cfg</span><span class="hl-1">(</span><span class="hl-8">5</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">save</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">wait</span><span class="hl-1">() </span><span class="hl-7">// call wait() to start the promise chain</span><br/><span class="hl-1">  .</span><span class="hl-0">then</span><span class="hl-1">(({ </span><span class="hl-4">images</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// process images array</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">finally</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">());</span>
</code><button>Copy</button></pre>
<a id="md:image-to-image-with-task-status-monitoring" class="tsd-anchor"></a><h3><a href="#md:image-to-image-with-task-status-monitoring">Image to Image with Task Status Monitoring</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">BasePipe</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfyui-client&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">fs</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;fs&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">BasePipe</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">with</span><span class="hl-1">(</span><span class="hl-7">/* client instance */</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">model</span><span class="hl-1">(</span><span class="hl-2">&quot;sdxl.safetensors&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">image</span><span class="hl-1">(</span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-0">readFileSync</span><span class="hl-1">(</span><span class="hl-2">&quot;path-to-your-input-image.jpg&quot;</span><span class="hl-1">))</span><br/><span class="hl-1">  </span><span class="hl-7">// .mask(maskImage) // call mask() to add a mask</span><br/><span class="hl-1">  .</span><span class="hl-0">prompt</span><span class="hl-1">(</span><span class="hl-2">&quot;A husky with pearls, oil painting style&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">negative</span><span class="hl-1">(</span><span class="hl-2">&quot;Low quality, blurry&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">size</span><span class="hl-1">(</span><span class="hl-8">640</span><span class="hl-1">, </span><span class="hl-8">960</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">steps</span><span class="hl-1">(</span><span class="hl-8">35</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">cfg</span><span class="hl-1">(</span><span class="hl-8">7</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">denoise</span><span class="hl-1">(</span><span class="hl-8">0.5</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">save</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;progress&quot;</span><span class="hl-1">, </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">wait</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">then</span><span class="hl-1">(({ </span><span class="hl-4">images</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Process generated images</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">finally</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">());</span>
</code><button>Copy</button></pre>
<a id="md:loras-and-cnets-with-efficient" class="tsd-anchor"></a><h3><a href="#md:loras-and-cnets-with-efficient">LoRAs and CNets with Efficient</a></h3><p><code>EfficientPipe</code> is based on the <code>Efficient</code> series nodes provided by <code>efficiency-nodes-comfyui</code> to expand lora/cnet features.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">EfficientPipe</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfyui-client&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">input_image</span><span class="hl-1"> = </span><span class="hl-7">/* image data Buffer() */</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">images</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">EfficientPipe</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">with</span><span class="hl-1">(</span><span class="hl-4">client</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">model</span><span class="hl-1">(</span><span class="hl-2">&quot;sd15.safetensors&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">seed</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">image</span><span class="hl-1">(</span><span class="hl-4">input_image</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">prompt</span><span class="hl-1">(</span><span class="hl-2">&quot;furry, A husky girl with pearls, oil painting style&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">negative</span><span class="hl-1">(</span><span class="hl-2">&quot;low quality, blurry&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">size</span><span class="hl-1">(</span><span class="hl-8">640</span><span class="hl-1">, </span><span class="hl-8">960</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">steps</span><span class="hl-1">(</span><span class="hl-8">35</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">cfg</span><span class="hl-1">(</span><span class="hl-8">5</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">denoise</span><span class="hl-1">(</span><span class="hl-8">0.6</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">cnet</span><span class="hl-1">(</span><span class="hl-2">&quot;control_v11p_sd15_openpose.pth&quot;</span><span class="hl-1">, </span><span class="hl-4">input_image</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">lora</span><span class="hl-1">(</span><span class="hl-2">&quot;LowRA.safetensors&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">lora</span><span class="hl-1">(</span><span class="hl-2">&quot;add_detail.safetensors&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">save</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">wait</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:more-examples" class="tsd-anchor"></a><h3><a href="#md:more-examples">more examples</a></h3><p>For complete example code, refer to the files <a href="./examples/nodejs/src/"><code>./examples/nodejs/src/main-pipe-*.ts</code></a> in the project repository.</p>
<a id="md:workflow-usage" class="tsd-anchor"></a><h2><a href="#md:workflow-usage">Workflow Usage</a></h2><a id="md:programmablehuman-readable-pattern" class="tsd-anchor"></a><h3><a href="#md:programmablehuman-readable-pattern">Programmable/Human-readable pattern</a></h3><p>Inspired by <a href="https://github.com/comfyanonymous/ComfyUI/issues/612">this issue</a> and <a href="https://github.com/Chaoses-Ib/ComfyScript">this library</a>, this library provides a programmable workflow interface.</p>
<p>It has the following use cases:</p>
<ul>
<li><strong>Interactive GUI Integration</strong>: Offers support for seamless integration with ComfyUI&#39;s new GUI, enhancing user interaction possibilities.</li>
<li><strong>LLMs for Workflow Generation</strong>: Leverages the ability of large language models to understand Javascript for creating workflows.</li>
<li><strong>Cross-Project Workflow Reuse</strong>: Enables the sharing and repurposing of workflow components across different projects using ComfyUI.</li>
<li><strong>Custom Node Creation</strong>: Assists in developing and integrating custom nodes into existing workflows for expanded functionality.</li>
<li><strong>Workflow Visualization</strong>: Facilitates a clearer understanding of workflows by translating them into a visual format suitable for ComfyUI&#39;s GUI.</li>
<li><strong>Model Research and Development</strong>: Provides a framework for leveraging ComfyUI nodes in machine learning research without execution capabilities.</li>
<li><strong>Script-Driven Workflow Templates</strong>: Enables the generation of templated workflows through scripting for consistent and efficient project setups.</li>
<li><strong>Web UI-independent Workflow Deployment</strong>: Enables the creation and deployment of workflows without reliance on a web-based user interface.</li>
</ul>
<a id="md:minimal-case" class="tsd-anchor"></a><h3><a href="#md:minimal-case">Minimal case</a></h3><p>Here is a minimal example demonstrating how to create and execute a simple workflow using this library.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Workflow</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfyui-client&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">workflow</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Workflow</span><span class="hl-1">();</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">cls</span><span class="hl-1"> = </span><span class="hl-4">workflow</span><span class="hl-1">.</span><span class="hl-4">classes</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">model</span><span class="hl-1">, </span><span class="hl-6">clip</span><span class="hl-1">, </span><span class="hl-6">vae</span><span class="hl-1">] = </span><span class="hl-4">cls</span><span class="hl-1">.</span><span class="hl-0">CheckpointLoaderSimple</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">ckpt_name:</span><span class="hl-1"> </span><span class="hl-2">&quot;sdxl.safetensors&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">enc</span><span class="hl-1"> = (</span><span class="hl-4">text</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">cls</span><span class="hl-1">.</span><span class="hl-0">CLIPTextEncode</span><span class="hl-1">({ </span><span class="hl-4">text</span><span class="hl-1">, </span><span class="hl-4">clip</span><span class="hl-1"> })[</span><span class="hl-8">0</span><span class="hl-1">];</span><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">samples</span><span class="hl-1">] = </span><span class="hl-4">cls</span><span class="hl-1">.</span><span class="hl-0">KSampler</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">seed:</span><span class="hl-1"> </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">() * </span><span class="hl-8">2</span><span class="hl-1"> ** </span><span class="hl-8">32</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">steps:</span><span class="hl-1"> </span><span class="hl-8">35</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">cfg:</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">sampler_name:</span><span class="hl-1"> </span><span class="hl-2">&quot;dpmpp_2m_sde_gpu&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">scheduler:</span><span class="hl-1"> </span><span class="hl-2">&quot;karras&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">denoise:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">model</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">positive:</span><span class="hl-1"> </span><span class="hl-0">enc</span><span class="hl-1">(</span><span class="hl-2">&quot;best quality, 1girl&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">negative:</span><span class="hl-1"> </span><span class="hl-0">enc</span><span class="hl-1">(</span><span class="hl-2">&quot;worst quality, bad anatomy, embedding:NG_DeepNegative_V1_75T&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">latent_image:</span><span class="hl-1"> </span><span class="hl-4">cls</span><span class="hl-1">.</span><span class="hl-0">EmptyLatentImage</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">width:</span><span class="hl-1"> </span><span class="hl-8">512</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">height:</span><span class="hl-1"> </span><span class="hl-8">512</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">batch_size:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  })[</span><span class="hl-8">0</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><span class="hl-4">cls</span><span class="hl-1">.</span><span class="hl-0">SaveImage</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">filename_prefix:</span><span class="hl-1"> </span><span class="hl-2">&quot;from-sc-comfy-ui-client&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">images:</span><span class="hl-1"> </span><span class="hl-4">cls</span><span class="hl-1">.</span><span class="hl-0">VAEDecode</span><span class="hl-1">({ </span><span class="hl-4">samples</span><span class="hl-1">, </span><span class="hl-4">vae</span><span class="hl-1"> })[</span><span class="hl-8">0</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">// This call will return a JSON object that can be used for ComfyUI API calls, primarily for demonstration or debugging purposes</span><br/><span class="hl-1">  </span><span class="hl-4">workflow</span><span class="hl-1">.</span><span class="hl-0">workflow</span><span class="hl-1">(),</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:programable-real-world-case" class="tsd-anchor"></a><h3><a href="#md:programable-real-world-case">Programable real world case</a></h3><p>Both implementation and usage are extremely simple and human-readable. This programmable approach allows for dynamic workflow creation, enabling loops, conditionals, and reusable functions. It&#39;s particularly useful for batch processing, experimenting with different models or prompts, and creating more complex, flexible workflows.</p>
<p>This specific workflow demonstrates the generation of multiple images using two different AI models (&quot;lofi_v5&quot; and &quot;case-h-beta&quot;) and four different dress styles. It showcases how to create a reusable image generation pipeline and apply it across various prompts and models efficiently.</p>
<p>Below is a simple example of creating a workflow:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">createWorkflow</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">workflow</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Workflow</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">KSampler</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">CheckpointLoaderSimple</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">EmptyLatentImage</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">CLIPTextEncode</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">VAEDecode</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">SaveImage</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">NODE1</span><span class="hl-1">,</span><br/><span class="hl-1">  } = </span><span class="hl-4">workflow</span><span class="hl-1">.</span><span class="hl-4">classes</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">width</span><span class="hl-1"> = </span><span class="hl-8">640</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">height</span><span class="hl-1"> = </span><span class="hl-8">960</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">batch_size</span><span class="hl-1"> = </span><span class="hl-8">1</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">seed</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">() * </span><span class="hl-8">2</span><span class="hl-1"> ** </span><span class="hl-8">32</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pos</span><span class="hl-1"> = </span><span class="hl-2">&quot;best quality, 1girl&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">neg</span><span class="hl-1"> = </span><span class="hl-2">&quot;worst quality, bad anatomy, embedding:NG_DeepNegative_V1_75T&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">model1_name</span><span class="hl-1"> = </span><span class="hl-2">&quot;lofi_v5.baked.fp16.safetensors&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">model2_name</span><span class="hl-1"> = </span><span class="hl-2">&quot;case-h-beta.baked.fp16.safetensors&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sampler_settings</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">seed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">steps:</span><span class="hl-1"> </span><span class="hl-8">35</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">cfg:</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">sampler_name:</span><span class="hl-1"> </span><span class="hl-2">&quot;dpmpp_2m_sde_gpu&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">scheduler:</span><span class="hl-1"> </span><span class="hl-2">&quot;karras&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">denoise:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">model1</span><span class="hl-1">, </span><span class="hl-6">clip1</span><span class="hl-1">, </span><span class="hl-6">vae1</span><span class="hl-1">] = </span><span class="hl-0">CheckpointLoaderSimple</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">ckpt_name:</span><span class="hl-1"> </span><span class="hl-4">model1_name</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">model2</span><span class="hl-1">, </span><span class="hl-6">clip2</span><span class="hl-1">, </span><span class="hl-6">vae2</span><span class="hl-1">] = </span><span class="hl-0">CheckpointLoaderSimple</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">ckpt_name:</span><span class="hl-1"> </span><span class="hl-4">model2_name</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">dress_case</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;white yoga&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;black office&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;pink sportswear&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;cosplay&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ];</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">generate</span><span class="hl-1"> = (</span><span class="hl-4">model</span><span class="hl-1">, </span><span class="hl-4">clip</span><span class="hl-1">, </span><span class="hl-4">vae</span><span class="hl-1">, </span><span class="hl-4">pos</span><span class="hl-1">, </span><span class="hl-4">neg</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">latent_image</span><span class="hl-1">] = </span><span class="hl-0">EmptyLatentImage</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">width</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">height</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">batch_size</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">positive</span><span class="hl-1">] = </span><span class="hl-0">CLIPTextEncode</span><span class="hl-1">({ </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">pos</span><span class="hl-1">, </span><span class="hl-4">clip</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">negative</span><span class="hl-1">] = </span><span class="hl-0">CLIPTextEncode</span><span class="hl-1">({ </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">neg</span><span class="hl-1">, </span><span class="hl-4">clip</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">samples</span><span class="hl-1">] = </span><span class="hl-0">KSampler</span><span class="hl-1">({</span><br/><span class="hl-1">      ...</span><span class="hl-4">sampler_settings</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">model</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">positive</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">negative</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">latent_image</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">image</span><span class="hl-1">] = </span><span class="hl-0">VAEDecode</span><span class="hl-1">({ </span><span class="hl-4">samples</span><span class="hl-1">, </span><span class="hl-4">vae</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">image</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">save</span><span class="hl-1"> = (</span><span class="hl-4">image</span><span class="hl-1">, </span><span class="hl-4">filename_prefix</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">SaveImage</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">images:</span><span class="hl-1"> </span><span class="hl-4">image</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">filename_prefix</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">cloth</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-4">dress_case</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">input_pos1</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">pos</span><span class="hl-5">}</span><span class="hl-2">, </span><span class="hl-5">${</span><span class="hl-4">cloth</span><span class="hl-5">}</span><span class="hl-2"> dress`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">image1</span><span class="hl-1"> = </span><span class="hl-0">generate</span><span class="hl-1">(</span><span class="hl-4">model1</span><span class="hl-1">, </span><span class="hl-4">clip1</span><span class="hl-1">, </span><span class="hl-4">vae1</span><span class="hl-1">, </span><span class="hl-4">input_pos1</span><span class="hl-1">, </span><span class="hl-4">neg</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">input_pos2</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">pos</span><span class="hl-5">}</span><span class="hl-2">, </span><span class="hl-5">${</span><span class="hl-4">cloth</span><span class="hl-5">}</span><span class="hl-2"> dress`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">image2</span><span class="hl-1"> = </span><span class="hl-0">generate</span><span class="hl-1">(</span><span class="hl-4">model2</span><span class="hl-1">, </span><span class="hl-4">clip2</span><span class="hl-1">, </span><span class="hl-4">vae2</span><span class="hl-1">, </span><span class="hl-4">input_pos2</span><span class="hl-1">, </span><span class="hl-4">neg</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-0">save</span><span class="hl-1">(</span><span class="hl-4">image1</span><span class="hl-1">, </span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">cloth</span><span class="hl-5">}</span><span class="hl-2">-lofi-v5`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">save</span><span class="hl-1">(</span><span class="hl-4">image2</span><span class="hl-1">, </span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">cloth</span><span class="hl-5">}</span><span class="hl-2">-case-h-beta`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">workflow</span><span class="hl-1">;</span><br/><span class="hl-1">};</span>
</code><button>Copy</button></pre>
<p>Yes, you read that rightwe will repeatedly create some nodes, which might seem counterintuitive, but it&#39;s perfectly fine because the workflow will not be rendered within the ComfyUI server. Instead, it will execute each node sequentially, so even if creating a workflow with thousands of nodes is executable and correct.</p>
<p>Notably, you can also leverage all your JavaScript programming knowledge, such as <code>recursion</code>, <code>functional programming</code>, <code>currying</code>, etc. For example, you can do something like this:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">generator</span><span class="hl-1"> = (</span><span class="hl-4">model</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">clip</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">vae</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">pos</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">neg</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">latent_image</span><span class="hl-1">] = </span><span class="hl-0">EmptyLatentImage</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">width</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">height</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">batch_size</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">positive</span><span class="hl-1">] = </span><span class="hl-0">CLIPTextEncode</span><span class="hl-1">({ </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">pos</span><span class="hl-1">, </span><span class="hl-4">clip</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">negative</span><span class="hl-1">] = </span><span class="hl-0">CLIPTextEncode</span><span class="hl-1">({ </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">neg</span><span class="hl-1">, </span><span class="hl-4">clip</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">samples</span><span class="hl-1">] = </span><span class="hl-0">KSampler</span><span class="hl-1">({</span><br/><span class="hl-1">    ...</span><span class="hl-4">sampler_settings</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">model</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">positive</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">negative</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">latent_image</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">image</span><span class="hl-1">] = </span><span class="hl-0">VAEDecode</span><span class="hl-1">({ </span><span class="hl-4">samples</span><span class="hl-1">, </span><span class="hl-4">vae</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">image</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">model1_gen</span><span class="hl-1"> = </span><span class="hl-0">generator</span><span class="hl-1">(</span><span class="hl-4">model1</span><span class="hl-1">)(</span><span class="hl-4">clip1</span><span class="hl-1">)(</span><span class="hl-4">vae1</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:invoke-workflow" class="tsd-anchor"></a><h4><a href="#md:invoke-workflow">Invoke workflow</a></h4><pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">wf1</span><span class="hl-1"> = </span><span class="hl-0">createWorkflow</span><span class="hl-1">();</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">wf1</span><span class="hl-1">.</span><span class="hl-0">invoke</span><span class="hl-1">(</span><span class="hl-4">client</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<blockquote>
<p>Q: What is the relationship between workflow and client? ?</p>
<p>A: If you need to refer to complete example code, you can check out the <a href="./examples/nodejs/src">./examples/nodejs/main*.ts</a> entry files. These contain fully executable code examples ranging from the simplest to slightly more complex workflows.</p>
</blockquote>
<a id="md:type-support" class="tsd-anchor"></a><h3><a href="#md:type-support">type support</a></h3><ul>
<li>builtin node types</li>
</ul>
<p><img src="https://raw.githubusercontent.com/StableCanvas/comfyui-client/main/assets/type_hints.png" alt="node types"></p>
<ul>
<li>builtin node params</li>
</ul>
<p><img src="https://raw.githubusercontent.com/StableCanvas/comfyui-client/main/assets/params.png" alt="node params"></p>
<ul>
<li>any other node</li>
</ul>
<p><img src="https://raw.githubusercontent.com/StableCanvas/comfyui-client/main/assets/anynode.png" alt="other node"></p>
<a id="md:invokedworkflow" class="tsd-anchor"></a><h4><a href="#md:invokedworkflow">InvokedWorkflow</a></h4><p>If you need to manage the life cycle of your request, then this class can be very convenient</p>
<p>instance</p>
<pre><code class="language-ts"><span class="hl-7">// You can instantiate manually</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">invoked</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">InvokedWorkflow</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-7">/* workflow payload */</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">client</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><span class="hl-7">// or use the workflow api to instantiate</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">invoked</span><span class="hl-1"> = </span><span class="hl-4">your_workflow</span><span class="hl-1">.</span><span class="hl-0">instance</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<p>running</p>
<pre><code class="language-ts"><span class="hl-7">// job enqueue</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">invoked</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">();</span><br/><span class="hl-7">// job result promise</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">job_promise</span><span class="hl-1"> = </span><span class="hl-4">invoked</span><span class="hl-1">.</span><span class="hl-0">wait</span><span class="hl-1">();</span><br/><span class="hl-7">// if you want interrupt it</span><br/><span class="hl-4">invoked</span><span class="hl-1">.</span><span class="hl-0">interrupt</span><span class="hl-1">();</span><br/><span class="hl-7">// query job status</span><br/><span class="hl-4">invoked</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:client-plugin" class="tsd-anchor"></a><h2><a href="#md:client-plugin">Client Plugin</a></h2><p>We provide <code>Plugin</code> to expand Client capabilities.</p>
<p>simple example</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Plugin</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfy&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-9">LoggingPlugin</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-9">Plugin</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-5">super</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">addHook</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;function&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;fetch&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fn</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">original</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;fetch args&quot;</span><span class="hl-1">, </span><span class="hl-4">args</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">resp</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">original</span><span class="hl-1">(...</span><span class="hl-4">args</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;fetch resp&quot;</span><span class="hl-1">, </span><span class="hl-4">resp</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">resp</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:comfyui-login-auth" class="tsd-anchor"></a><h3><a href="#md:comfyui-login-auth">ComfyUI Login Auth</a></h3><p>For example, sometimes you may need to provide node authentication capabilities, and you may have many solutions to implement your ComfyUI permission management</p>
<p>If you use the <a href="https://github.com/liusida/ComfyUI-Login/tree/main">ComfyUI-Login</a> extension, you can use the built-in <code>plugins.LoginAuthPlugin</code> to configure the Client to support authentication</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Client</span><span class="hl-1">, </span><span class="hl-4">plugins</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@stable-canvas/comfyui-client&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-7">/* client instance */</span><span class="hl-1">;</span><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-4">plugins</span><span class="hl-1">.</span><span class="hl-0">LoginAuthPlugin</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">token:</span><span class="hl-1"> </span><span class="hl-2">&quot;MY_TOP_SECRET&quot;</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:events" class="tsd-anchor"></a><h2><a href="#md:events">Events</a></h2><a id="md:subscribing-to-custom-events" class="tsd-anchor"></a><h3><a href="#md:subscribing-to-custom-events">Subscribing to Custom Events</a></h3><p>If your ComfyUI instance emits custom WebSocket events, you can subscribe to them as follows:</p>
<pre><code class="language-ts"><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;your_custom_event_type&quot;</span><span class="hl-1">, (</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// &#39;data&#39; contains the event payload object</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Received custom event:&quot;</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:handling-unsubscribed-events" class="tsd-anchor"></a><h3><a href="#md:handling-unsubscribed-events">Handling Unsubscribed Events</a></h3><p>To capture and process events that haven&#39;t been explicitly subscribed to, use the <code>unhandled</code> event listener:</p>
<pre><code class="language-ts"><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;unhandled&quot;</span><span class="hl-1">, ({ </span><span class="hl-4">type</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// &#39;type&#39; is the event type</span><br/><span class="hl-1">  </span><span class="hl-7">// &#39;data&#39; is the event payload object</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Received unhandled event of type &#39;</span><span class="hl-5">${</span><span class="hl-4">type</span><span class="hl-5">}</span><span class="hl-2">&#39;:`</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:handling-all-event-messages" class="tsd-anchor"></a><h3><a href="#md:handling-all-event-messages">Handling All Event Messages</a></h3><p>Register the <code>message</code> event to subscribe to all WebSocket messages pushed from ComfyUI</p>
<pre><code class="language-ts"><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1"> !== </span><span class="hl-2">&quot;string&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">type</span><span class="hl-1">, </span><span class="hl-6">data</span><span class="hl-1"> } = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">// ...</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:handling-workflow-events" class="tsd-anchor"></a><h3><a href="#md:handling-workflow-events">Handling Workflow Events</a></h3><p>If you&#39;ve created a workflow instance, you can also subscribe to events emitted by that instance:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">invoked_wk</span><span class="hl-1"> = </span><span class="hl-4">workflow</span><span class="hl-1">.</span><span class="hl-0">instance</span><span class="hl-1">(</span><span class="hl-4">client</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">invoked_wk</span><span class="hl-1"> = </span><span class="hl-7">/* or new InvokedWorkflow() */</span><span class="hl-1">;</span><br/><br/><span class="hl-4">invoked_wk</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;execution_interrupted&quot;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Workflow execution interrupted&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:custom-resolver" class="tsd-anchor"></a><h2><a href="#md:custom-resolver">Custom Resolver</a></h2><p>Sometimes, you might use ComfyUI to generate non-image outputs, such as music, text, object detection results, etc. In these cases, you&#39;ll need a custom resolver, as the default behavior of this library primarily focuses on handling image generation.</p>
<p>Here&#39;s how to define a custom resolver:</p>
<blockquote>
<p>Suppose you have a final output node is custom non-image node, and its output might be <code>{ &quot;result&quot;: &quot;hi, I&#39;m phi3&quot; }</code>.</p>
</blockquote>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">resolver</span><span class="hl-1"> = (</span><span class="hl-4">resp</span><span class="hl-1">, </span><span class="hl-4">node_output</span><span class="hl-1">, </span><span class="hl-4">ctx</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// const { client, prompt_id, node_id } = ctx;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    ...</span><span class="hl-4">resp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">data:</span><span class="hl-1"> </span><span class="hl-4">resp</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1"> ?? </span><span class="hl-4">node_output</span><span class="hl-1">.</span><span class="hl-4">result</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">};</span>
</code><button>Copy</button></pre>
<p>You can then use this resolver with <code>client.enqueue</code>:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">prompt</span><span class="hl-1"> = { ... };</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">resp</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">&lt;</span><span class="hl-9">string</span><span class="hl-1">&gt;(</span><span class="hl-4">prompt</span><span class="hl-1">, { </span><span class="hl-4">resolver</span><span class="hl-1"> });</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">resp</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">); </span><span class="hl-7">// &quot;hi, I&#39;m phi3&quot;</span>
</code><button>Copy</button></pre>
<p>You can also apply the same resolver to a workflow using <code>workflow.invoke</code>:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">workflow</span><span class="hl-1"> = </span><span class="hl-7">/* class Workflow */</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">workflow</span><span class="hl-1">.</span><span class="hl-0">invoke</span><span class="hl-1">(</span><span class="hl-4">client</span><span class="hl-1">, { </span><span class="hl-4">resolver</span><span class="hl-1"> });</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">); </span><span class="hl-7">// &quot;hi, I&#39;m phi3&quot;</span>
</code><button>Copy</button></pre>
<a id="md:handling-non-standard-node-names" class="tsd-anchor"></a><h2><a href="#md:handling-non-standard-node-names">Handling Non-Standard Node Names</a></h2><p>ComfyUI does not enforce strict naming conventions for nodes, which can lead to custom nodes with names containing spaces or special characters. These names, such as <code>Efficient Loader</code>, <code>DSINE-NormalMapPreprocessor</code>, or <code>Robust Video Matting</code>, are challenging to use directly as variable names in code.</p>
<p>To address this issue, we provide the <code>workflow.node</code> interface. This interface allows you to create nodes using string-based names, regardless of whether they conform to standard variable naming rules.</p>
<pre><code class="language-typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">workflow</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Workflow</span><span class="hl-1">();</span><br/><br/><span class="hl-7">// Incorrect: Cannot destructure directly</span><br/><span class="hl-7">// const { Efficient Loader } = workflow.classes;</span><br/><br/><span class="hl-7">// Correct: Use the workflow.node method to create nodes</span><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">output1</span><span class="hl-1">, </span><span class="hl-6">output2</span><span class="hl-1">] = </span><span class="hl-4">workflow</span><span class="hl-1">.</span><span class="hl-0">node</span><span class="hl-1">(</span><span class="hl-2">&quot;Efficient Loader&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-7">// Node parameters</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:what-is-scriptdatajson" class="tsd-anchor"></a><h2><a href="#md:what-is-scriptdatajson">What is <code>./script/data/\*.json</code></a></h2><a id="md:comfyuinodetypesjson" class="tsd-anchor"></a><h3><a href="#md:comfyuinodetypesjson"><code>comfyui.node.types.json</code></a></h3><p>This file comes from the ComfyUI runtime and is used during code generation to annotate output types.</p>
<p>(The types here refer to internal types used by ComfyUI; in the generated code, they are only written as comments without any type checking.)</p>
<p>It is generated by a script. Since the script is extremely simple, it doesnt make sense to open source it for now. Also, whether this file is correct or not does not affect the use of the library, so it wont be updated in real-time.</p>
<a id="md:workflow-to-code" class="tsd-anchor"></a><h2><a href="#md:workflow-to-code">Workflow to code</a></h2><p>A common user case: You need to convert a workflow into code, modify it, or integrate it into your project.<br>Here, we provide very convenient tools to help you achieve this goal. We offer both an <strong>online Transpiler</strong> and a <strong>CLI</strong>. Using either of these methods, you can input a workflow (PNG or JSON), and it will be converted into code that complies with the requirements of this library.</p>
<p>For relatively simple text-to-image workflows, you can almost use the generated code directly.<br>For more complex workflows, you only need to make minor adjustments to the inputs and outputs to use them.</p>
<a id="md:1-online-transpiler" class="tsd-anchor"></a><h3><a href="#md:1-online-transpiler">1. Online Transpiler</a></h3><p><a href="https://stablecanvas.github.io/tool-w2c/">https://stablecanvas.github.io/tool-w2c/</a></p>
<p>Online convert workflow to code.</p>
<a id="md:2-cli" class="tsd-anchor"></a><h3><a href="#md:2-cli">2. CLI</a></h3><pre><code><span class="hl-4">npm</span><span class="hl-1"> </span><span class="hl-4">install</span><span class="hl-1"> @</span><span class="hl-4">stable</span><span class="hl-1">-</span><span class="hl-4">canvas</span><span class="hl-1">/</span><span class="hl-4">comfyui</span><span class="hl-1">-</span><span class="hl-4">client</span><span class="hl-1">-</span><span class="hl-4">cli</span>
</code><button>Copy</button></pre>
<p>This tool converts the input workflow into executable code that uses this library.</p>
<pre><code><span class="hl-10">Usage</span><span class="hl-1">: </span><span class="hl-4">nodejs</span><span class="hl-1">-</span><span class="hl-4">comfy</span><span class="hl-1">-</span><span class="hl-4">ui</span><span class="hl-1">-</span><span class="hl-4">client</span><span class="hl-1">-</span><span class="hl-4">code</span><span class="hl-1">-</span><span class="hl-4">gen</span><span class="hl-1"> [</span><span class="hl-4">options</span><span class="hl-1">]</span><br/><br/><span class="hl-4">Use</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1"> </span><span class="hl-4">tool</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">generate</span><span class="hl-1"> </span><span class="hl-4">the</span><span class="hl-1"> </span><span class="hl-4">corresponding</span><span class="hl-1"> </span><span class="hl-4">calling</span><span class="hl-1"> </span><span class="hl-4">code</span><span class="hl-1"> </span><span class="hl-5">using</span><span class="hl-1"> </span><span class="hl-6">workflow</span><br/><br/><span class="hl-10">Options</span><span class="hl-1">:</span><br/><span class="hl-1">  -</span><span class="hl-6">V</span><span class="hl-1">, --</span><span class="hl-4">version</span><span class="hl-1">              </span><span class="hl-4">output</span><span class="hl-1"> </span><span class="hl-4">the</span><span class="hl-1"> </span><span class="hl-4">version</span><span class="hl-1"> </span><span class="hl-4">number</span><br/><span class="hl-1">  -</span><span class="hl-4">t</span><span class="hl-1">, --</span><span class="hl-4">template</span><span class="hl-1"> [</span><span class="hl-4">template</span><span class="hl-1">]  </span><span class="hl-4">Specify</span><span class="hl-1"> </span><span class="hl-4">the</span><span class="hl-1"> </span><span class="hl-4">template</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-4">generating</span><span class="hl-1"> </span><span class="hl-4">code</span><span class="hl-1">, </span><span class="hl-4">builtin</span><span class="hl-1"> </span><span class="hl-10">tpl</span><span class="hl-1">: [</span><span class="hl-4">esm</span><span class="hl-1">,</span><span class="hl-4">cjs</span><span class="hl-1">,</span><span class="hl-4">web</span><span class="hl-1">,</span><span class="hl-4">none</span><span class="hl-1">]</span><br/><span class="hl-1">                             (</span><span class="hl-4">default</span><span class="hl-1">: </span><span class="hl-2">&quot;esm&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  -o, --out [output]         Specify the output file for the generated code. default to stdout</span><br/><span class="hl-1">  -i, --in &lt;</span><span class="hl-9">input</span><span class="hl-1">&gt;           Specify the input file, support .json/.png file</span><br/><span class="hl-1">  -h, --help                 display help for command</span>
</code><button>Copy</button></pre>
<p><a href="https://github.com/StableCanvas/comfyui-client/tree/main/packages/cli">more info: https://github.com/StableCanvas/comfyui-client/tree/main/packages/cli</a></p>
<a id="md:roadmap" class="tsd-anchor"></a><h2><a href="#md:roadmap">Roadmap</a></h2><ul>
<li><input checked="" disabled="" type="checkbox"> workflow to code: Transpiler workflow to code<ul>
<li><input checked="" disabled="" type="checkbox"> .json =&gt; code</li>
<li><input checked="" disabled="" type="checkbox"> .png =&gt; code</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> code to workflow: Output a json file that can be imported into the web front end</li>
<li><input disabled="" type="checkbox"> Output type hints</li>
</ul>
<a id="md:contributing" class="tsd-anchor"></a><h2><a href="#md:contributing">Contributing</a></h2><p>Contributions are welcome! Please feel free to submit a pull request.</p>
<a id="md:building" class="tsd-anchor"></a><h2><a href="#md:building">Building</a></h2><pre><code class="language-zsh"><span class="hl-7"># Prior to the first build: `npm run build-types` to generate types for Comfy nodes.</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">build-types</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">build</span>
</code><button>Copy</button></pre>
<a id="md:license" class="tsd-anchor"></a><h2><a href="#md:license">License</a></h2><p>MIT</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:stable-canvascomfyui-client"><span>@stable-<wbr/>canvas/comfyui-<wbr/>client</span></a><ul><li><a href="#md:features"><span>Features</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><ul><li><a href="#md:cdn"><span>CDN</span></a></li><li><a href="#md:comfyui-dependencies-optional"><span>ComfyUI <wbr/>Dependencies (optional)</span></a></li><li><a href="#md:browser-polyfill-optional"><span>Browser <wbr/>Polyfill (optional)</span></a></li></ul></li><li><a href="#md:client-usage"><span>Client <wbr/>Usage</span></a></li><li><ul><li><a href="#md:routes"><span>Routes</span></a></li><li><ul><li><a href="#md:release-model--free-memory"><span>Release <wbr/>Model / <wbr/>Free <wbr/>Memory</span></a></li><li><a href="#md:custom-routes"><span>Custom <wbr/>Routes</span></a></li></ul></li><li><a href="#md:advanced-functions"><span>Advanced functions</span></a></li><li><ul><li><a href="#md:enqueue"><span>enqueue</span></a></li><li><a href="#md:get-xxx"><span>Get XXX</span></a></li></ul></li></ul></li><li><a href="#md:pipeline-usage"><span>Pipeline <wbr/>Usage</span></a></li><li><ul><li><a href="#md:text-to-image"><span>Text to <wbr/>Image</span></a></li><li><a href="#md:image-to-image-with-task-status-monitoring"><span>Image to <wbr/>Image with <wbr/>Task <wbr/>Status <wbr/>Monitoring</span></a></li><li><a href="#md:loras-and-cnets-with-efficient"><span>LoRAs and CNets with <wbr/>Efficient</span></a></li><li><a href="#md:more-examples"><span>more examples</span></a></li></ul></li><li><a href="#md:workflow-usage"><span>Workflow <wbr/>Usage</span></a></li><li><ul><li><a href="#md:programmablehuman-readable-pattern"><span>Programmable/<wbr/>Human-<wbr/>readable pattern</span></a></li><li><a href="#md:minimal-case"><span>Minimal case</span></a></li><li><a href="#md:programable-real-world-case"><span>Programable real world case</span></a></li><li><ul><li><a href="#md:invoke-workflow"><span>Invoke workflow</span></a></li></ul></li><li><a href="#md:type-support"><span>type support</span></a></li><li><ul><li><a href="#md:invokedworkflow"><span>Invoked<wbr/>Workflow</span></a></li></ul></li></ul></li><li><a href="#md:client-plugin"><span>Client <wbr/>Plugin</span></a></li><li><ul><li><a href="#md:comfyui-login-auth"><span>ComfyUI <wbr/>Login <wbr/>Auth</span></a></li></ul></li><li><a href="#md:events"><span>Events</span></a></li><li><ul><li><a href="#md:subscribing-to-custom-events"><span>Subscribing to <wbr/>Custom <wbr/>Events</span></a></li><li><a href="#md:handling-unsubscribed-events"><span>Handling <wbr/>Unsubscribed <wbr/>Events</span></a></li><li><a href="#md:handling-all-event-messages"><span>Handling <wbr/>All <wbr/>Event <wbr/>Messages</span></a></li><li><a href="#md:handling-workflow-events"><span>Handling <wbr/>Workflow <wbr/>Events</span></a></li></ul></li><li><a href="#md:custom-resolver"><span>Custom <wbr/>Resolver</span></a></li><li><a href="#md:handling-non-standard-node-names"><span>Handling <wbr/>Non-<wbr/>Standard <wbr/>Node <wbr/>Names</span></a></li><li><a href="#md:what-is-scriptdatajson"><span>What is ./script/data/\*.json</span></a></li><li><ul><li><a href="#md:comfyuinodetypesjson"><span>comfyui.node.types.json</span></a></li></ul></li><li><a href="#md:workflow-to-code"><span>Workflow to code</span></a></li><li><ul><li><a href="#md:1-online-transpiler"><span>1. <wbr/>Online <wbr/>Transpiler</span></a></li><li><a href="#md:2-cli"><span>2. CLI</span></a></li></ul></li><li><a href="#md:roadmap"><span>Roadmap</span></a></li><li><a href="#md:contributing"><span>Contributing</span></a></li><li><a href="#md:building"><span>Building</span></a></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@stable-canvas/comfyui-client - v1.5.6</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>